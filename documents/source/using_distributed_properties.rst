==================
MIシステム遠隔実行
==================

MIシステムから一部のモジュールの計算をMIシステム外の計算機を使用してワークフローを実行するための情報を記述する。

※今回の実証は遠隔接続が可能な環境において行われた。遠隔接続の可不可については後述する。

概要
=====
企業がMIシステムを使用する場合に、以下のような問題が発生することが想定されている。
- 企業（または大学）が利用するソフトウェアのライセンスが企業（または大学）にしかない場合。
- 企業が持ち出しできないデータ・ツール（プログラム）をワークフローの中で使いたい場合。
- 企業（または大学）にある特定のハードウェア（スーパーコンピューター、大規模GPU計算環境など）を使いたい場合。

このような場合、MIシステム側から上記のような場所、または計算機（または計算機群）へ遠隔実行を行えることが求められる。
具体的には専用のモジュールと専用の計算機ノードを用意し、使用することで、これらの要求を満たすことが可能になる。
本書はこれらを実行するための実証実験のための情報を記述する。

遠隔実行のパターン
==================
本実証試験では以下の２つの事例について実証した。
- sshなどでMIシステムの任意のモジュールから直接遠隔計算を実行する。
- WEBAPIを利用してMIシステムの任意のモジュールからポーリング形式で遠隔計算を実行させる。

SSHを利用した遠隔実行
=====================

最初にsshを利用して、MIシステムの任意のモジュールから遠隔地にある計算機を利用した計算を行う例をとりあげる。

実証実験の条件
--------------

本事例における遠隔実行には可能な場合と不可能な場合がある、以下のような場合不可能である。
* MIシステムが設置されている組織から外部の組織へssh等の接続が理論的に遮断されている場合。
* 遠隔実行を行う計算機のある組織が外部からの接続を理論的に遮断している場合。

遠隔実行のイメージ
------------------
本事例では、以下のようなシステムを想定している。

.. figure:: images/remote_execution_image.png
  :scale:80%
  :align:center
  
  遠隔実行のイメージ

このようにして、特定のモジュール（Abaqus2017）と特定の計算ノード（計算ノード２）を用意し、計算ノード２がMIシステム外にある計算機を遠隔実行できるように設定して、使用することでMIシステム外の計算機または計算機群をMIシステム内にあるかのごとく計算（ワークフロー）を実行することが可能になる。  
※mermaindで記述した上記図を[別なissue番号](https://gitlab.mintsys.jp/midev/misrc_remote_workflow/issues/3)に挙げてあります。

.. raw:: latex

    \newpage

遠隔実行の実際
-----------------

- MIシステム側。
    - 遠隔実行専用の計算ノードの設置を行った。
    - 遠隔実行用予測モジュールを作成した。
    - 同モジュールはこの計算ノードを指定して計算を行うよう設計された。
- MIシステム外（主に要件）
    - LAN到達可能な場所。
    - 可能ならLinux（MacまたはWindowsでも可能）。

検証内容
------------
専用計算ノードでは以下のような動作が行われるように、専用モジュールが定義するプログラムを実行する。
- パラメータ類の遠隔計算機へ送信（遠隔計算機側にあるパラメータまたはファイルを指定することも可）。
- 遠隔計算機でソルバー（プログラム）の実行。
- 実行が終了したら結果ファイルの取得。

動作検証
---------
本事例では下記のようなイメージの動作検証環境用ワークフローを用意した。

.. figure:: workflow_with_sshmodule.png
  :scale: 80%
  :align: center
  
  動作検証用のワークフロー

※赤枠の部分が遠隔実行が行われるモジュールである。

検証結果
--------
動作検証環境を使用し、以下の検証を行い、すべて想定の動作を行ったことを確認した。
- 動作環境の赤枠のモジュールから遠隔計算機へプログラム実行の確認。
- 遠隔計算機上でワークフローのモジュールから遠隔プログラム実行の動作要求受付とその実行の確認。
- 遠隔計算機のプログラム終了後、計算結果のMIシステム上への取得とGPDB、アセット管理へのデータの格納および移行。

本格的な運用のために
--------------------
今は遠隔実行される計算機およびソルバーは特定の計算機、特定のソルバーだが、できる限り汎用的に使えるようにする工夫またはユーザーの要望を受けつける手法の整備などの対応策が必要である。その手法は今後の課題となる。今現在考えられるものをいかに挙げる。
- 既知のソルバーを遠隔実行できる汎用化された予測モデルおよびモジュールの準備。
- 遠隔実行に必要な準備のリスト化。
    - 遠隔実行に使う計算機の準備（ssh到達できるための準備など）
    - 接続方法の選択（パスワードなし、公開鍵認証、認証情報埋込式など）
    - 実行プログラム実行方法の取得
    
    